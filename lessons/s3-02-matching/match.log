-----------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/matching/match.log
  log type:  text
 opened on:   9 May 2017, 14:47:33

. 
. /* Matching Examples */
. /* Following Zhao, 2004 examples of difft kinds of matching */
. /* Will Doyle */
. /* 160509 */
. /* Practicum Folder */
. 
. 
. *ssc install nnmatch
. *ssc install psmatch2
. *ssc install sensatt
. *net search attnd
. *ssc install rbounds
. /* install st0026_2 */
. /* Super Useful Source: http://www.ssc.wisc.edu/sscc/pubs/stata_psmatch.htm*/    
. 
. clear

. 
. clear mata /* Clears any fluff that might be in mata */

. 
. clear matrix

. 
. set matsize 4000

. 
. set maxvar 10000


. 
. estimates clear /* Clears any estimates hanging around */

. 
. set more off /*Get rid of annoying "more" feature */ 

. 
. graph set print logo off /*No Stata logo on graphics */

. 
. use attain2, clear

. 
. /*Only bachelor's intending students */
. 
. keep if bystexp>=5 & bystexp~=.   
(4962 observations deleted)

. 
. /*recodoe dv*/
. 
. gen bach_plus=.
(11235 missing values generated)

. replace bach_plus=1 if f3attainment>=6 & f3attainment<.
(4449 real changes made)

. replace bach_plus=0 if f3attainment<6
(6786 real changes made)

.     
. drop if bach_plus==.    
(0 observations deleted)

.         
. /*recode treatment */
. drop cc

. gen cc=.
(11235 missing values generated)

. replace cc=1 if first_inst==3
(2455 real changes made)

. replace cc=0 if first==1 | first_inst==2 | first_inst==4
(5958 real changes made)

. 
. /*Locals */
. 
. local y bach_plus

. 
. local t cc

. 
. local controls  byses1  bynels2m bynels2r amind asian black hispanic white  bysex 

. 
. /*Basic pattern*/
.     
. tab  `t' `y' ,row 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       bach_plus
        cc |         0          1 |     Total
-----------+----------------------+----------
         0 |     2,342      3,616 |     5,958 
           |     39.31      60.69 |    100.00 
-----------+----------------------+----------
         1 |     1,867        588 |     2,455 
           |     76.05      23.95 |    100.00 
-----------+----------------------+----------
     Total |     4,209      4,204 |     8,413 
           |     50.03      49.97 |    100.00 


. 
. 
. /*Examining possible selection bias */
. 
.  kdensity byses1 if `t'==1, ///
>  addplot(kdensity byses1 if `t'==0, lpattern(dash)) ///
>  legend(order(1 "Treated"  2 "Untreated")) 

. 
.  
. /* Balance on various covariates */
. 
. ttest byses1, by(`t')

Two-sample t test with equal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       0 |    5958    .3800705    .0091189    .7038729    .3621941    .3979469
       1 |    2455    .0046965    .0134423    .6660368   -.0216628    .0310559
---------+--------------------------------------------------------------------
combined |    8413    .2705325    .0077812    .7137086    .2552795    .2857855
---------+--------------------------------------------------------------------
    diff |             .375374    .0166212                .3427923    .4079556
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  22.5841
Ho: diff = 0                                     degrees of freedom =     8411

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 1.0000         Pr(|T| > |t|) = 0.0000          Pr(T > t) = 0.0000

. 
. ttest bynels2m, by(`t')

Two-sample t test with equal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       0 |    5958    .5301661    .0014761    .1139378    .5272724    .5330598
       1 |    2455    .4435691    .0023659    .1172247    .4389297    .4482084
---------+--------------------------------------------------------------------
combined |    8413    .5048962    .0013242    .1214572    .5023005    .5074919
---------+--------------------------------------------------------------------
    diff |             .086597    .0027558                 .081195     .091999
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  31.4238
Ho: diff = 0                                     degrees of freedom =     8411

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 1.0000         Pr(|T| > |t|) = 0.0000          Pr(T > t) = 0.0000

. 
. /*Naive Estimate */
. 
. ttest `y' ,by(`t')

Two-sample t test with equal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       0 |    5958    .6069151    .0063284    .4884764    .5945091     .619321
       1 |    2455    .2395112    .0086153    .4268721    .2226171    .2564053
---------+--------------------------------------------------------------------
combined |    8413    .4997028    .0054516    .5000296    .4890165    .5103892
---------+--------------------------------------------------------------------
    diff |            .3674039    .0113039                .3452454    .3895624
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  32.5023
Ho: diff = 0                                     degrees of freedom =     8411

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 1.0000         Pr(|T| > |t|) = 0.0000          Pr(T > t) = 0.0000

. 
. reg `y' `t' `controls', vce(robust)

Linear regression                                      Number of obs =    8413
                                                       F( 10,  8402) =  287.08
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.2068
                                                       Root MSE      =  .44559

------------------------------------------------------------------------------
             |               Robust
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |   -.241531   .0115965   -20.83   0.000     -.264263   -.2187991
      byses1 |   .0964151   .0076581    12.59   0.000     .0814033    .1114269
    bynels2m |    .714464   .0597938    11.95   0.000     .5972535    .8316745
    bynels2r |   .4457718   .0847348     5.26   0.000     .2796707    .6118728
       amind |   .0199686   .0718492     0.28   0.781    -.1208736    .1608107
       asian |   .1007321   .0281537     3.58   0.000      .045544    .1559203
       black |   .0052428   .0276665     0.19   0.850    -.0489903    .0594759
    hispanic |   .0377626   .0277472     1.36   0.174    -.0166288     .092154
       white |    .055331    .024242     2.28   0.022     .0078107    .1028512
       bysex |   .0717579   .0099721     7.20   0.000     .0522102    .0913055
       _cons |  -.1261829   .0383826    -3.29   0.001    -.2014222   -.0509435
------------------------------------------------------------------------------

. 
. 
. 
. /* Propensity Score Matching: 1 to 1 */
.   psmatch2 `t'   ///
>          `controls', ///
>          outcome(`y') ///
>          neighbor(1) ///
>          caliper(.25) ///
>          noreplacement /// /* This gives 1 to 1 */
>          common

Probit regression                                 Number of obs   =       8413
                                                  LR chi2(9)      =    1257.86
                                                  Prob > chi2     =     0.0000
Log likelihood =  -4450.543                       Pseudo R2       =     0.1238

------------------------------------------------------------------------------
          cc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      byses1 |  -.2806996   .0239003   -11.74   0.000    -.3275432    -.233856
    bynels2m |  -2.473156   .1828498   -13.53   0.000    -2.831535   -2.114777
    bynels2r |  -2.421198   .2552144    -9.49   0.000    -2.921409   -1.920987
       amind |   -.027666   .2102839    -0.13   0.895    -.4398149    .3844829
       asian |  -.0831598   .0859851    -0.97   0.333    -.2516874    .0853679
       black |  -.4151329   .0848895    -4.89   0.000    -.5815133   -.2487525
    hispanic |   .0532603   .0839636     0.63   0.526    -.1113054     .217826
       white |   .0494742   .0735598     0.67   0.501    -.0947003    .1936487
       bysex |  -.0876795   .0314502    -2.79   0.005    -.1493208   -.0260382
       _cons |   1.658342   .1153738    14.37   0.000     1.432214    1.884471
------------------------------------------------------------------------------
----------------------------------------------------------------------------------------
        Variable     Sample |    Treated     Controls   Difference         S.E.   T-stat
----------------------------+-----------------------------------------------------------
       bach_plus  Unmatched | .239511202   .606915072  -.367403871    .01130393   -32.50
                        ATT | .251544572   .475728155  -.224183583   .013900955   -16.13
----------------------------+-----------------------------------------------------------
Note: S.E. does not take into account that the propensity score is estimated.

 psmatch2: |   psmatch2: Common
 Treatment |        support
assignment | Off suppo  On suppor |     Total
-----------+----------------------+----------
 Untreated |         0      5,958 |     5,958 
   Treated |       189      2,266 |     2,455 
-----------+----------------------+----------
     Total |       189      8,224 |     8,413 


.          
. pstest `controls', treated(`t')  both

----------------------------------------------------------------------------------------
                Unmatched |       Mean               %reduct |     t-test    |  V(T)/
Variable          Matched | Treated Control    %bias  |bias| |    t    p>|t| |  V(C)
--------------------------+----------------------------------+---------------+----------
byses1                 U  |  .0047   .38007    -54.8         | -22.58  0.000 |  0.90*
                       M  | .06386   .03315      4.5    91.8 |   1.55  0.121 |  0.83*
                          |                                  |               |
bynels2m               U  | .44357   .53017    -74.9         | -31.42  0.000 |  1.06
                       M  |  .4579   .45522      2.3    96.9 |   0.81  0.416 |  0.95
                          |                                  |               |
bynels2r               U  | .29031   .34859    -71.6         | -30.18  0.000 |  1.10*
                       M  | .30021    .2979      2.8    96.0 |   0.99  0.320 |  1.00
                          |                                  |               |
amind                  U  | .00733   .00436      3.9         |   1.72  0.086 |     .
                       M  | .00706   .00838     -1.7    55.4 |  -0.51  0.611 |     .
                          |                                  |               |
asian                  U  | .10305   .11078     -2.5         |  -1.03  0.301 |     .
                       M  | .10238   .10106      0.4    82.9 |   0.15  0.883 |     .
                          |                                  |               |
black                  U  | .12179   .11027      3.6         |   1.51  0.130 |     .
                       M  | .12974   .12974      0.0   100.0 |  -0.00  1.000 |     .
                          |                                  |               |
hispanic               U  | .15967   .08627     22.5         |   9.93  0.000 |     .
                       M  | .12798   .13725     -2.8    87.4 |  -0.92  0.358 |     .
                          |                                  |               |
white                  U  | .56253   .64267    -16.4         |  -6.90  0.000 |     .
                       M  | .58429   .57811      1.3    92.3 |   0.42  0.673 |     .
                          |                                  |               |
bysex                  U  | 1.5625   1.5557      1.4         |   0.57  0.568 |  1.00
                       M  | 1.5635    1.556      1.5   -10.3 |   0.51  0.611 |  1.00
                          |                                  |               |
----------------------------------------------------------------------------------------
* if variance ratio outside [0.92; 1.08] for U and [0.92; 1.09] for M

-----------------------------------------------------------------------------------
 Sample    | Ps R2   LR chi2   p>chi2   MeanBias   MedBias      B      R     %Var
-----------+-----------------------------------------------------------------------
 Unmatched | 0.124   1257.86    0.000     28.0      16.4      89.9*   0.96     50
 Matched   | 0.001      4.52    0.874      1.9       1.7       6.3    0.79     25
-----------------------------------------------------------------------------------
* if B>25%, R outside [0.5; 2]

. 
. psgraph

. 
. 
. /* Teffects -- PS matching, 1 to 1 */
.     teffects psmatch (`y') (`t' `controls'), ///
>         nn(1) ///
>             atet 

Treatment-effects estimation                    Number of obs      =      8413
Estimator      : propensity-score matching      Matches: requested =         1
Outcome model  : matching                                      min =         1
Treatment model: logit                                         max =         1
------------------------------------------------------------------------------
             |              AI Robust
   bach_plus |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
ATET         |
          cc |
   (1 vs 0)  |  -.2175153   .0156337   -13.91   0.000    -.2481567   -.1868738
------------------------------------------------------------------------------

.          
. 
. /*Replciate psmatch2*/
. 
. teffects psmatch (`y') (`t' `controls', probit), atet

Treatment-effects estimation                    Number of obs      =      8413
Estimator      : propensity-score matching      Matches: requested =         1
Outcome model  : matching                                      min =         1
Treatment model: probit                                        max =         1
------------------------------------------------------------------------------
             |              AI Robust
   bach_plus |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
ATET         |
          cc |
   (1 vs 0)  |  -.2191446   .0156477   -14.00   0.000    -.2498135   -.1884758
------------------------------------------------------------------------------

. 
.                  
. /* Teffects -- Nearest Neighbor matching, 4 neighboring units */
.     teffects nnmatch (`y' `controls')  ///
>     (`t'), ///
>     nn(4) 

Treatment-effects estimation                    Number of obs      =      8413
Estimator      : nearest-neighbor matching      Matches: requested =         4
Outcome model  : matching                                      min =         4
Distance metric: Mahalanobis                                   max =         4
------------------------------------------------------------------------------
             |              AI Robust
   bach_plus |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
ATE          |
          cc |
   (1 vs 0)  |  -.2615595   .0140409   -18.63   0.000    -.2890792   -.2340398
------------------------------------------------------------------------------

. 
.         
. 
. 
. /* Propensity Score Matching: 1 to 4 */
.   psmatch2 `t'   ///
>          `controls', ///
>          outcome(`y') ///
>          neighbor(4) ///
>          caliper(.25) 

Probit regression                                 Number of obs   =       8413
                                                  LR chi2(9)      =    1257.86
                                                  Prob > chi2     =     0.0000
Log likelihood =  -4450.543                       Pseudo R2       =     0.1238

------------------------------------------------------------------------------
          cc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      byses1 |  -.2806996   .0239003   -11.74   0.000    -.3275432    -.233856
    bynels2m |  -2.473156   .1828498   -13.53   0.000    -2.831535   -2.114777
    bynels2r |  -2.421198   .2552144    -9.49   0.000    -2.921409   -1.920987
       amind |   -.027666   .2102839    -0.13   0.895    -.4398149    .3844829
       asian |  -.0831598   .0859851    -0.97   0.333    -.2516874    .0853679
       black |  -.4151329   .0848895    -4.89   0.000    -.5815133   -.2487525
    hispanic |   .0532603   .0839636     0.63   0.526    -.1113054     .217826
       white |   .0494742   .0735598     0.67   0.501    -.0947003    .1936487
       bysex |  -.0876795   .0314502    -2.79   0.005    -.1493208   -.0260382
       _cons |   1.658342   .1153738    14.37   0.000     1.432214    1.884471
------------------------------------------------------------------------------
----------------------------------------------------------------------------------------
        Variable     Sample |    Treated     Controls   Difference         S.E.   T-stat
----------------------------+-----------------------------------------------------------
       bach_plus  Unmatched | .239511202   .606915072  -.367403871    .01130393   -32.50
                        ATT | .239511202   .454684318  -.215173116   .013739364   -15.66
----------------------------+-----------------------------------------------------------
Note: S.E. does not take into account that the propensity score is estimated.

           | psmatch2:
 psmatch2: |   Common
 Treatment |  support
assignment | On suppor |     Total
-----------+-----------+----------
 Untreated |     5,958 |     5,958 
   Treated |     2,455 |     2,455 
-----------+-----------+----------
     Total |     8,413 |     8,413 


. 
. 
. 
. /*How this gets results */
. 
. reg `y' `t' [iweight=_weight]

      Source |       SS       df       MS              Number of obs =    4910
-------------+------------------------------           F(  1,  4908) =  264.17
       Model |  56.8325993     1  56.8325993           Prob > F      =  0.0000
    Residual |  1055.87604  4908  .215133668           R-squared     =  0.0511
-------------+------------------------------           Adj R-squared =  0.0509
       Total |  1112.70864  4909  .226667069           Root MSE      =  .46383

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.2151731   .0132386   -16.25   0.000    -.2411268   -.1892195
       _cons |   .4546843   .0093611    48.57   0.000     .4363323    .4730363
------------------------------------------------------------------------------

.  
.  
. /*Regression on balanced sample */
.     
. reg `y' `t' `controls' [iweight=_weight] 

      Source |       SS       df       MS              Number of obs =    4910
-------------+------------------------------           F( 10,  4899) =   87.92
       Model |  169.314211    10  16.9314211           Prob > F      =  0.0000
    Residual |  943.394433  4899  .192568776           R-squared     =  0.1522
-------------+------------------------------           Adj R-squared =  0.1504
       Total |  1112.70864  4909  .226667069           Root MSE      =  .43883

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.2166894   .0125274   -17.30   0.000    -.2412487     -.19213
      byses1 |   .0935016   .0098732     9.47   0.000     .0741456    .1128576
    bynels2m |   .7271517   .0734762     9.90   0.000     .5831054    .8711979
    bynels2r |   .4524674    .103225     4.38   0.000     .2501001    .6548348
       amind |   .0122751   .0751457     0.16   0.870    -.1350441    .1595943
       asian |   .1422103   .0359161     3.96   0.000     .0717986    .2126221
       black |   .0034311   .0350778     0.10   0.922    -.0653371    .0721993
    hispanic |   .0309862   .0338328     0.92   0.360    -.0353412    .0973136
       white |   .0390738   .0308416     1.27   0.205    -.0213895    .0995372
       bysex |   .0732529   .0128956     5.68   0.000     .0479717    .0985342
       _cons |  -.1546891   .0466104    -3.32   0.001    -.2460664   -.0633117
------------------------------------------------------------------------------

. 
. 
. /*Regression with ps as control */
. reg `y' `t' `controls'  _pscore

      Source |       SS       df       MS              Number of obs =    8413
-------------+------------------------------           F( 11,  8401) =  199.32
       Model |    435.3097    11  39.5736091           Prob > F      =  0.0000
    Residual |  1667.93956  8401  .198540597           R-squared     =  0.2070
-------------+------------------------------           Adj R-squared =  0.2059
       Total |  2103.24926  8412  .250029631           Root MSE      =  .44558

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.2412631   .0115399   -20.91   0.000    -.2638842   -.2186421
      byses1 |   .0797526   .0164437     4.85   0.000     .0475189    .1119862
    bynels2m |   .5588246   .1486039     3.76   0.000     .2675244    .8501248
    bynels2r |   .2927395   .1575187     1.86   0.063     -.016036    .6015149
       amind |   .0192156    .071022     0.27   0.787    -.1200051    .1584363
       asian |   .0977172   .0274312     3.56   0.000     .0439453    .1514891
       black |  -.0199359   .0350845    -0.57   0.570      -.08871    .0488383
    hispanic |   .0433986   .0278143     1.56   0.119    -.0111243    .0979215
       white |   .0580316   .0237189     2.45   0.014     .0115367    .1045264
       bysex |   .0662922    .011063     5.99   0.000      .044606    .0879784
     _pscore |  -.1999906   .1748736    -1.14   0.253     -.542786    .1428048
       _cons |   .0751244    .180222     0.42   0.677     -.278155    .4284039
------------------------------------------------------------------------------

. 
. 
. /* Stratification on ps: using weighted results */
. 
. sum _pscore, detail

                 psmatch2: Propensity Score
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0412568       .0166836
 5%     .0712046        .017694
10%     .0946163       .0179706       Obs                8413
25%       .15213       .0193431       Sum of Wgt.        8413

50%     .2537457                      Mean            .290643
                        Largest       Std. Dev.      .1745636
75%     .3969711       .8583255
90%     .5490311       .8602592       Variance       .0304724
95%     .6363642       .8689796       Skewness       .8116249
99%     .7631331       .8720549       Kurtosis       3.040829

. 
. 
. scalar pscore25=r(p25)

. 
. 
. scalar pscore50=r(p50)

. 
. 
. scalar pscore75=r(p75)

. 
. scalar n_full=r(N)

. 
. /* First quartile */
. reg `y' `t' `controls'  if _pscore<=pscore25

      Source |       SS       df       MS              Number of obs =    2104
-------------+------------------------------           F( 10,  2093) =   14.25
       Model |  25.8886783    10  2.58886783           Prob > F      =  0.0000
    Residual |  380.337557  2093  .181718852           R-squared     =  0.0637
-------------+------------------------------           Adj R-squared =  0.0593
       Total |  406.226236  2103  .193165114           Root MSE      =  .42628

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.2979157   .0338634    -8.80   0.000    -.3643252   -.2315062
      byses1 |   .0619005   .0202011     3.06   0.002     .0222841    .1015169
    bynels2m |   .5010968   .1739424     2.88   0.004     .1599786    .8422149
    bynels2r |   .3341547   .2140255     1.56   0.119    -.0855704    .7538798
       amind |   .0495782   .2508498     0.20   0.843    -.4423629    .5415192
       asian |   .0195004   .0530168     0.37   0.713    -.0844708    .1234715
       black |  -.0085254   .0578704    -0.15   0.883    -.1220149    .1049641
    hispanic |  -.0096023   .0675935    -0.14   0.887    -.1421599    .1229553
       white |   .0594855   .0476488     1.25   0.212    -.0339584    .1529294
       bysex |   .0734349   .0195185     3.76   0.000     .0351572    .1117126
       _cons |   .0999931   .1543214     0.65   0.517    -.2026463    .4026324
------------------------------------------------------------------------------

. 
. scalar e1=_b[`t']

. 
. scalar se1=_se[`t']

. 
. scalar var1=se1^2

. 
. scalar n1=e(N)

. 
. /*Second Quartile */
. 
. reg `y' `t' `controls' if _pscore>=pscore25  & _pscore<pscore50

      Source |       SS       df       MS              Number of obs =    2103
-------------+------------------------------           F( 10,  2092) =   23.38
       Model |  50.8978802    10  5.08978802           Prob > F      =  0.0000
    Residual |   455.35319  2092  .217664049           R-squared     =  0.1005
-------------+------------------------------           Adj R-squared =  0.0962
       Total |   506.25107  2102  .240842564           Root MSE      =  .46654

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.3079171   .0254771   -12.09   0.000    -.3578802   -.2579539
      byses1 |   .1115868   .0306976     3.64   0.000     .0513859    .1717878
    bynels2m |   .6868734   .2698757     2.55   0.011     .1576205    1.216126
    bynels2r |   .2854857   .2879453     0.99   0.322    -.2792035    .8501749
       amind |  -.0548086   .1715812    -0.32   0.749    -.3912963    .2816792
       asian |   .1061088   .0573667     1.85   0.065     -.006393    .2186107
       black |  -.0479342    .071132    -0.67   0.500    -.1874311    .0915627
    hispanic |   .0385535   .0605979     0.64   0.525    -.0802849    .1573919
       white |   .0690066   .0475206     1.45   0.147     -.024186    .1621991
       bysex |   .1105936    .022365     4.94   0.000     .0667336    .1544537
       _cons |  -.0987421   .2538491    -0.39   0.697    -.5965653    .3990811
------------------------------------------------------------------------------

. 
. scalar e2=_b[`t']

. 
. scalar se2=_se[`t']

. 
. scalar var2=se2^2

. 
. scalar n2=e(N)

. 
. /*Third Quartile */
. 
. reg `y' `t' `controls'   if _pscore>=pscore50  & _pscore<pscore75

      Source |       SS       df       MS              Number of obs =    2103
-------------+------------------------------           F( 10,  2092) =   19.17
       Model |  43.3385753    10  4.33385753           Prob > F      =  0.0000
    Residual |  473.024715  2092  .226111241           R-squared     =  0.0839
-------------+------------------------------           Adj R-squared =  0.0796
       Total |  516.363291  2102  .245653326           Root MSE      =  .47551

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.2630958   .0218813   -12.02   0.000    -.3060072   -.2201844
      byses1 |   .0937747   .0293155     3.20   0.001     .0362842    .1512652
    bynels2m |   .5807158   .2503189     2.32   0.020     .0898158    1.071616
    bynels2r |   .4404302   .2729806     1.61   0.107    -.0949117    .9757722
       amind |   .2074082    .151641     1.37   0.172    -.0899748    .5047911
       asian |    .109577   .0599853     1.83   0.068    -.0080602    .2272141
       black |    -.04543    .068199    -0.67   0.505    -.1791749    .0883149
    hispanic |  -.0312784   .0582593    -0.54   0.591    -.1455307    .0829739
       white |  -.0042078   .0503215    -0.08   0.933    -.1028933    .0944777
       bysex |   .0191796   .0223738     0.86   0.391    -.0246977    .0630569
       _cons |   .0688029   .2046693     0.34   0.737    -.3325738    .4701796
------------------------------------------------------------------------------

. 
. scalar e3=_b[`t']

. 
. scalar se3=_se[`t']

. 
. scalar var3=se3^2

. 
. scalar n3=e(N)

. 
. /*Fourth Quartile */
.   
. reg `y' `t' `controls'   if _pscore>pscore75

      Source |       SS       df       MS              Number of obs =    2103
-------------+------------------------------           F( 10,  2092) =   18.71
       Model |  30.6403297    10  3.06403297           Prob > F      =  0.0000
    Residual |  342.507554  2092   .16372254           R-squared     =  0.0821
-------------+------------------------------           Adj R-squared =  0.0777
       Total |  373.147884  2102  .177520402           Root MSE      =  .40463

------------------------------------------------------------------------------
   bach_plus |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          cc |  -.1515525   .0178828    -8.47   0.000    -.1866224   -.1164826
      byses1 |   .0731778   .0154386     4.74   0.000     .0429012    .1034545
    bynels2m |   .6707124   .1208825     5.55   0.000     .4336499    .9077749
    bynels2r |   .4062347   .1591723     2.55   0.011     .0940821    .7183872
       amind |  -.0144915   .0956012    -0.15   0.880     -.201975    .1729919
       asian |   .1773562   .0497353     3.57   0.000     .0798204     .274892
       black |   .0483671   .0481774     1.00   0.316    -.0461136    .1428477
    hispanic |   .0982387   .0454403     2.16   0.031     .0091257    .1873516
       white |   .0845955    .042989     1.97   0.049     .0002898    .1689011
       bysex |   .0640275   .0183999     3.48   0.001     .0279434    .1001115
       _cons |  -.1914981   .0741242    -2.58   0.010    -.3368629   -.0461333
------------------------------------------------------------------------------

. 
. scalar e4=_b[`t']

. 
. scalar se4=_se[`t']

. 
. scalar var4=se4^2

. 
. scalar n4=e(N)

. 
. /*Combining estimates */
. 
. scalar myest=(e1*(n1/n_full))+(e2*(n2/n_full))+(e3*(n3/n_full))+(e4*(n4/n_full)) /*Weighted average of estimates, based on sample size*
> /

. 
. scalar myvar=(var1*(n1/n_full))+(var2*(n2/n_full))+(var3*(n3/n_full))+(var4*(n4/n_full)) /*Weighted average of variances */

. 
. scalar myse=sqrt(myvar)

. 
. di "Estimate is " myest
Estimate is -.25512537

. 
. di "SE is " myse
SE is .02546879

. 
. 
. /* Propensity Score Matching: Calipers, multiple matches */
.   
.   psmatch2 `t' ///
>          `controls' , ///
>          outcome(`y') ///
>          caliper(.25) ///
>          common ///
>          neighbor(3) 

Probit regression                                 Number of obs   =       8413
                                                  LR chi2(9)      =    1257.86
                                                  Prob > chi2     =     0.0000
Log likelihood =  -4450.543                       Pseudo R2       =     0.1238

------------------------------------------------------------------------------
          cc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      byses1 |  -.2806996   .0239003   -11.74   0.000    -.3275432    -.233856
    bynels2m |  -2.473156   .1828498   -13.53   0.000    -2.831535   -2.114777
    bynels2r |  -2.421198   .2552144    -9.49   0.000    -2.921409   -1.920987
       amind |   -.027666   .2102839    -0.13   0.895    -.4398149    .3844829
       asian |  -.0831598   .0859851    -0.97   0.333    -.2516874    .0853679
       black |  -.4151329   .0848895    -4.89   0.000    -.5815133   -.2487525
    hispanic |   .0532603   .0839636     0.63   0.526    -.1113054     .217826
       white |   .0494742   .0735598     0.67   0.501    -.0947003    .1936487
       bysex |  -.0876795   .0314502    -2.79   0.005    -.1493208   -.0260382
       _cons |   1.658342   .1153738    14.37   0.000     1.432214    1.884471
------------------------------------------------------------------------------
----------------------------------------------------------------------------------------
        Variable     Sample |    Treated     Controls   Difference         S.E.   T-stat
----------------------------+-----------------------------------------------------------
       bach_plus  Unmatched | .239511202   .606915072  -.367403871    .01130393   -32.50
                        ATT | .239608802   .459793534  -.220184732    .01410513   -15.61
----------------------------+-----------------------------------------------------------
Note: S.E. does not take into account that the propensity score is estimated.

 psmatch2: |   psmatch2: Common
 Treatment |        support
assignment | Off suppo  On suppor |     Total
-----------+----------------------+----------
 Untreated |         0      5,958 |     5,958 
   Treated |         1      2,454 |     2,455 
-----------+----------------------+----------
     Total |         1      8,412 |     8,413 


.          
. 
. pstest _pscore `controls', treated(`t') both

----------------------------------------------------------------------------------------
                Unmatched |       Mean               %reduct |     t-test    |  V(T)/
Variable          Matched | Treated Control    %bias  |bias| |    t    p>|t| |  V(C)
--------------------------+----------------------------------+---------------+----------
_pscore                U  | .39266   .24861     86.7         |  37.12  0.000 |  1.28*
                       M  | .39247   .39245      0.0   100.0 |   0.00  0.997 |  1.00
                          |                                  |               |
byses1                 U  |  .0047   .38007    -54.8         | -22.58  0.000 |  0.90*
                       M  | .00528  -.00025      0.8    98.5 |   0.28  0.778 |  0.89*
                          |                                  |               |
bynels2m               U  | .44357   .53017    -74.9         | -31.42  0.000 |  1.06
                       M  | .44366   .44318      0.4    99.4 |   0.14  0.886 |  1.01
                          |                                  |               |
bynels2r               U  | .29031   .34859    -71.6         | -30.18  0.000 |  1.10*
                       M  | .29037   .29081     -0.5    99.2 |  -0.19  0.851 |  1.07
                          |                                  |               |
amind                  U  | .00733   .00436      3.9         |   1.72  0.086 |     .
                       M  | .00733   .00964     -3.0    22.2 |  -0.88  0.378 |     .
                          |                                  |               |
asian                  U  | .10305   .11078     -2.5         |  -1.03  0.301 |     .
                       M  |  .1031   .10052      0.8    66.6 |   0.30  0.765 |     .
                          |                                  |               |
black                  U  | .12179   .11027      3.6         |   1.51  0.130 |     .
                       M  | .12184   .12673     -1.5    57.6 |  -0.52  0.604 |     .
                          |                                  |               |
hispanic               U  | .15967   .08627     22.5         |   9.93  0.000 |     .
                       M  | .15933   .15743      0.6    97.4 |   0.18  0.855 |     .
                          |                                  |               |
white                  U  | .56253   .64267    -16.4         |  -6.90  0.000 |     .
                       M  | .56275   .56167      0.2    98.6 |   0.08  0.939 |     .
                          |                                  |               |
bysex                  U  | 1.5625   1.5557      1.4         |   0.57  0.568 |  1.00
                       M  | 1.5628   1.5594      0.7    50.1 |   0.24  0.811 |  1.00
                          |                                  |               |
----------------------------------------------------------------------------------------
* if variance ratio outside [0.92; 1.08] for U and [0.92; 1.08] for M

-----------------------------------------------------------------------------------
 Sample    | Ps R2   LR chi2   p>chi2   MeanBias   MedBias      B      R     %Var
-----------+-----------------------------------------------------------------------
 Unmatched | 0.127   1288.05    0.000     33.8      19.5      90.6*   0.64     60
 Matched   | 0.000      1.54    0.999      0.9       0.6       3.5    0.88     20
-----------------------------------------------------------------------------------
* if B>25%, R outside [0.5; 2]

. 
. 
.  kdensity _pscore if `t'==1 , ///
>  addplot(kdensity _pscore if `t'==0, lpattern(dash))  ///
>  legend(order(1 "Treated"  2 "Untreated")) 

.  
. 
. /* Propensity Score Matching: Calipers on propensity score and Mahalonobis metric */
.   psmatch2 `t' ///
>          `controls' , ///
>          outcome(`y') ///
>          caliper(.25) ///
>                  neighbor(4) /// 
>          common ///
>          mahal(bysex byses1)

Probit regression                                 Number of obs   =       8413
                                                  LR chi2(9)      =    1257.86
                                                  Prob > chi2     =     0.0000
Log likelihood =  -4450.543                       Pseudo R2       =     0.1238

------------------------------------------------------------------------------
          cc |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      byses1 |  -.2806996   .0239003   -11.74   0.000    -.3275432    -.233856
    bynels2m |  -2.473156   .1828498   -13.53   0.000    -2.831535   -2.114777
    bynels2r |  -2.421198   .2552144    -9.49   0.000    -2.921409   -1.920987
       amind |   -.027666   .2102839    -0.13   0.895    -.4398149    .3844829
       asian |  -.0831598   .0859851    -0.97   0.333    -.2516874    .0853679
       black |  -.4151329   .0848895    -4.89   0.000    -.5815133   -.2487525
    hispanic |   .0532603   .0839636     0.63   0.526    -.1113054     .217826
       white |   .0494742   .0735598     0.67   0.501    -.0947003    .1936487
       bysex |  -.0876795   .0314502    -2.79   0.005    -.1493208   -.0260382
       _cons |   1.658342   .1153738    14.37   0.000     1.432214    1.884471
------------------------------------------------------------------------------
----------------------------------------------------------------------------------------
        Variable     Sample |    Treated     Controls   Difference         S.E.   T-stat
----------------------------+-----------------------------------------------------------
       bach_plus  Unmatched | .239511202   .606915072  -.367403871    .01130393   -32.50
                        ATT | .239608802   .547371638  -.307762836   .015645117   -19.67
----------------------------+-----------------------------------------------------------
Note: S.E. does not take into account that the propensity score is estimated.

 psmatch2: |   psmatch2: Common
 Treatment |        support
assignment | Off suppo  On suppor |     Total
-----------+----------------------+----------
 Untreated |         0      5,958 |     5,958 
   Treated |         1      2,454 |     2,455 
-----------+----------------------+----------
     Total |         1      8,412 |     8,413 


.          
. 
. pstest _pscore `controls' , both

----------------------------------------------------------------------------------------
                Unmatched |       Mean               %reduct |     t-test    |  V(T)/
Variable          Matched | Treated Control    %bias  |bias| |    t    p>|t| |  V(C)
--------------------------+----------------------------------+---------------+----------
_pscore                U  | .39266   .24861     86.7         |  37.12  0.000 |  1.28*
                       M  | .39247   .30026     55.5    36.0 |  18.79  0.000 |  1.09*
                          |                                  |               |
byses1                 U  |  .0047   .38007    -54.8         | -22.58  0.000 |  0.90*
                       M  | .00528   .00565     -0.1    99.9 |  -0.02  0.984 |  1.00
                          |                                  |               |
bynels2m               U  | .44357   .53017    -74.9         | -31.42  0.000 |  1.06
                       M  | .44366   .50956    -57.0    23.9 | -19.36  0.000 |  0.93
                          |                                  |               |
bynels2r               U  | .29031   .34859    -71.6         | -30.18  0.000 |  1.10*
                       M  | .29037    .3339    -53.5    25.3 | -18.49  0.000 |  1.04
                          |                                  |               |
amind                  U  | .00733   .00436      3.9         |   1.72  0.086 |     .
                       M  | .00733   .00285      5.9   -51.0 |   2.21  0.027 |     .
                          |                                  |               |
asian                  U  | .10305   .11078     -2.5         |  -1.03  0.301 |     .
                       M  |  .1031   .12673     -7.6  -206.1 |  -2.60  0.009 |     .
                          |                                  |               |
black                  U  | .12179   .11027      3.6         |   1.51  0.130 |     .
                       M  | .12184   .14609     -7.6  -110.5 |  -2.49  0.013 |     .
                          |                                  |               |
hispanic               U  | .15967   .08627     22.5         |   9.93  0.000 |     .
                       M  | .15933   .11359     14.0    37.7 |   4.68  0.000 |     .
                          |                                  |               |
white                  U  | .56253   .64267    -16.4         |  -6.90  0.000 |     .
                       M  | .56275   .56846     -1.2    92.9 |  -0.40  0.687 |     .
                          |                                  |               |
bysex                  U  | 1.5625   1.5557      1.4         |   0.57  0.568 |  1.00
                       M  | 1.5628   1.5628      0.0   100.0 |   0.00  1.000 |  1.00
                          |                                  |               |
----------------------------------------------------------------------------------------
* if variance ratio outside [0.92; 1.08] for U and [0.92; 1.08] for M

-----------------------------------------------------------------------------------
 Sample    | Ps R2   LR chi2   p>chi2   MeanBias   MedBias      B      R     %Var
-----------+-----------------------------------------------------------------------
 Unmatched | 0.127   1288.05    0.000     33.8      19.5      90.6*   0.64     60
 Matched   | 0.083    562.54    0.000     20.2       7.6      69.5*   0.83     20
-----------------------------------------------------------------------------------
* if B>25%, R outside [0.5; 2]

. 
. /*Using sensatt */
. 
. /* Teffects -- Nearest Neighbor matching, 4 neighboring units */
.     teffects nnmatch (`y' `controls')  ///
>     (`t'), ///
>     nn(4) 

Treatment-effects estimation                    Number of obs      =      8413
Estimator      : nearest-neighbor matching      Matches: requested =         4
Outcome model  : matching                                      min =         4
Distance metric: Mahalanobis                                   max =         4
------------------------------------------------------------------------------
             |              AI Robust
   bach_plus |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
ATE          |
          cc |
   (1 vs 0)  |  -.2615595   .0140409   -18.63   0.000    -.2890792   -.2340398
------------------------------------------------------------------------------

. 
. 
. /* AIPW: Augmented Inverse Probability Weights */
.    teffects aipw (`y' `controls') ///
>     (`t' `controls') 

Iteration 0:   EE criterion =  2.700e-23  
Iteration 1:   EE criterion =  1.086e-32  

Treatment-effects estimation                    Number of obs      =      8413
Estimator      : augmented IPW
Outcome model  : linear by ML
Treatment model: logit
------------------------------------------------------------------------------
             |               Robust
   bach_plus |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
ATE          |
          cc |
   (1 vs 0)  |  -.2586804   .0130554   -19.81   0.000    -.2842686   -.2330922
-------------+----------------------------------------------------------------
POmean       |
          cc |
          0  |   .5630225    .006398    88.00   0.000     .5504827    .5755623
------------------------------------------------------------------------------

. 
. 
.         
. predict pscore, ps

. 
. gen pscore_weight=.
(11235 missing values generated)

. replace pscore_weight=1/pscore if `t'==1
(2455 real changes made)

. replace pscore_weight=pscore/(1-pscore) if `t'==0
(5958 real changes made)

. 
. 
. preserve

. sample 1000, count
(10235 observations deleted)

. 
. graph twoway (scatter pscore bynels2m [w=pscore_weight] if `t'==1, msize(vtiny) msymbol(circle_hollow)) ///
>     (scatter pscore bynels2m [w=pscore_weight] if `t'==0,msize(vtiny) msymbol(circle_hollow) ), ///
> legend (order(1 "PS, CC Attend" 2 "PS, 4yr Attend")) ytitle("Propensity Score")
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)
(analytic weights assumed)

. 
. restore

. 
. /*Similar confounders */
. 
.   
. sensatt `y' /// /*Outcome*/
>         `t' /// /*Treatment */
>        `controls' , ///  /*varlist */
>        alg(attnd) ///
>        p(black) ///
>        reps(100)



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.07
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.14
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.08
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.16

The probability of having U=1 if T=1 (p1.) is equal to:     0.12
The probability of having U=1 if T=0 (p0.) is equal to:     0.11



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 100 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.214       0.020        0.414       1.026

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.

. 
.            
. /*"Killer" confounders */
. 
. local probs .25 .5 .75

. 
. mat results=J(3,3,.)

. 
. local column=1

. 
. 
. foreach prob1 of local probs{
  2. 
.   local row=1
  3.   foreach prob2 of local probs{
  4. 
. 
. sensatt `y' /// /*Outcome*/
>         `t' /// /*Treatment */
>        `controls' , ///  /*varlist */
>        alg(attnd) ///
>        p11(`prob1') ///
>        p10(`prob1') ///
>        p01(`prob2') ///
>        p00(`prob2') ///
>        reps(50) 
  5. 
. di "`row',`column'"
  6. 
. mat results[`row',`column']=r(att)
  7. 
. local row=`row'+1
  8. 
. 
. }
  9.   local column=`column'+1 
 10. }



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.25
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.25
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.25
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.25

The probability of having U=1 if T=1 (p1.) is equal to:     0.25
The probability of having U=1 if T=0 (p0.) is equal to:     0.25



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.215       0.020        1.009       0.998

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
1,1



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.25
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.25
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.50
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.50

The probability of having U=1 if T=1 (p1.) is equal to:     0.25
The probability of having U=1 if T=0 (p0.) is equal to:     0.50



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.214       0.022        1.003       0.332

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
2,1



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.25
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.25
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.75
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.75

The probability of having U=1 if T=1 (p1.) is equal to:     0.25
The probability of having U=1 if T=0 (p0.) is equal to:     0.75



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.214       0.027        1.008       0.109

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
3,1



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.50
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.50
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.25
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.25

The probability of having U=1 if T=1 (p1.) is equal to:     0.50
The probability of having U=1 if T=0 (p0.) is equal to:     0.25



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.212       0.022        0.999       3.001

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
1,2



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.50
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.50
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.50
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.50

The probability of having U=1 if T=1 (p1.) is equal to:     0.50
The probability of having U=1 if T=0 (p0.) is equal to:     0.50



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.215       0.020        0.999       1.002

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
2,2



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.50
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.50
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.75
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.75

The probability of having U=1 if T=1 (p1.) is equal to:     0.50
The probability of having U=1 if T=0 (p0.) is equal to:     0.75



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.207       0.023        1.015       0.335

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
3,2



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.75
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.75
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.25
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.25

The probability of having U=1 if T=1 (p1.) is equal to:     0.75
The probability of having U=1 if T=0 (p0.) is equal to:     0.25



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.213       0.025        0.992       9.124

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
1,3



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.75
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.75
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.50
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.50

The probability of having U=1 if T=1 (p1.) is equal to:     0.75
The probability of having U=1 if T=0 (p0.) is equal to:     0.50



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.214       0.021        1.006       3.024

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
2,3



*** THIS IS THE BASELINE ATT ESTIMATION (WITH NO SIMULATED CONFOUNDER).


 The program is searching the nearest neighbor of each treated unit. 
 This operation may take a while.



ATT estimation with Nearest Neighbor Matching method 
(random draw version)
Analytical standard errors

---------------------------------------------------------
n. treat.   n. contr.         ATT    Std. Err.          t
---------------------------------------------------------

     2455        1614      -0.219        0.017    -12.796

---------------------------------------------------------
Note: the numbers of treated and controls refer to actual
nearest neighbour matches



*** THIS IS THE SIMULATED ATT ESTIMATION (WITH THE CONFOUNDER U).

The probability of having U=1 if T=1 and Y=1 (p11) is equal to:     0.75
The probability of having U=1 if T=1 and Y=0 (p10) is equal to:     0.75
The probability of having U=1 if T=0 and Y=1 (p01) is equal to:     0.75
The probability of having U=1 if T=0 and Y=0 (p00) is equal to:     0.75

The probability of having U=1 if T=1 (p1.) is equal to:     0.75
The probability of having U=1 if T=0 (p0.) is equal to:     0.75



 The program is iterating the ATT estimation with simulated confounder.
 You have chosen to perform 50 iterations. This step may take a while.



ATT estimation with simulated confounder
General multiple-imputation standard errors

-----------------------------------------------
      ATT    Std. Err.    Out. Eff.   Sel. Eff.
-----------------------------------------------

   -0.215       0.019        1.001       1.016

-----------------------------------------------
Note: Both the outcome and the selection effect
are odds ratios from logit estimations.
3,3

. 
. matrix rownames results="p1=25" "50" "75"

. matrix colnames results="p0=25" "50" "75"

. 
. mat li results

results[3,3]
            p0=25          50          75
p1=25   -.2146721  -.21183707  -.21331976
   50  -.21432994  -.21537271  -.21446843
   75  -.21385743  -.20729939  -.21458248

. 
. exit 

end of do-file


. exit, clear
