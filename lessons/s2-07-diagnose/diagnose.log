--------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/diagnose.log
  log type:  text
 opened on:  21 Mar 2017, 16:09:22

. 
. /* PhD Practicum, Spring 2017 */
. /* Diagnosing Problems with Regression */
. /* Will Doyle*/
. /* 3/21/2017 */
. /* Saved on Blackboard */
. 
. clear

. 
. graph drop _all

. 
. set scheme s1color

. 
. use griliches76
(Wages of Very Young Men, Zvi Griliches, J.Pol.Ec. 1976)

. 
. *local filetype rtf
. 
. local filetype tex

. 
. *local gtype png
. 
. local gtype pdf

. 
. /**************************************************/
. /*Recode  Data*/
. /* NB: doing this just to "screw things up" in interesting ways */
. /**************************************************/  
. 
. gen w=exp(lw)

. 
. gen expr2=expr*expr

. 
. drawnorm noise2,means(10) sds(2)

. 
. gen lw_het=lw

. 
. sum lw

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
          lw |       758    5.686739    .4289494      4.605      7.051

. 
. drawnorm mynoise3, mean(0) sd(3)

. 
. drawnorm mynoise4, mean(0) sd(4)

. 
. drawnorm mynoise5, mean(0) sd(5)

. 
. drawnorm mynoise6, mean(0) sd(6)

. 
. replace lw_het=4.4+.09*s+mynoise3 if s==10
(29 real changes made)

. 
. replace lw_het=4.4+.09*s+mynoise4 if s==12
(330 real changes made)

. 
. replace lw_het=4.4+.09*s+mynoise5 if s==14
(42 real changes made)

. 
. replace lw_het=4.4+.09*s+mynoise6 if s==16
(151 real changes made)

. 
. gen test3=iq+noise2

. 
. gen w_influence=w

. 
. replace w_influence=2000 if s==18& w>750 
(4 real changes made)

. 
. local y lw 

. 
. local x s

. 
. local controls kww iq expr tenure rns smsa med test3

. 
. /**************************************************/
. /* Basic descriptives and regression results */
. /**************************************************/
.   
. eststo descriptives: mean `y' `x' `controls'

Mean estimation                     Number of obs    =     758

--------------------------------------------------------------
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
          lw |   5.686739   .0155801      5.656153    5.717324
           s |   13.40501   .0810637      13.24588    13.56415
         kww |   36.57388   .2652295      36.05321    37.09455
          iq |   103.8562   .4946522      102.8851    104.8273
        expr |   1.735429   .0764767      1.585297     1.88556
      tenure |   1.831135    .060789        1.7118     1.95047
         rns |   .2691293   .0161195       .237485    .3007736
        smsa |   .7044855   .0165835      .6719303    .7370407
         med |   10.91029    .099562      10.71484    11.10574
       test3 |   113.8138   .5029683      112.8265    114.8012
--------------------------------------------------------------

. 
. #delimit;
delimiter now ;
. esttab descriptives using  "esttab_means.`filetype'",
>         label /* Use variable labels */
>         replace /*Replace file if it exists */
>         nostar /* No sig tests */
>         cells(b(fmt(2) label("Mean")) se(fmt(2) label("S.E.") ))
>         title("Descriptive Statistics for Variables in Analysis")
>         nonumbers
>         nomtitles
>         ;
(output written to esttab_means.tex)

. #delimit cr
delimiter now cr
. 
. estimates clear

. 
. /* Run the basic regression */
. reg `y' `x'

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  1,   756) =  255.70
       Model |  35.2039946     1  35.2039946           Prob > F      =  0.0000
    Residual |  104.082155   756  .137674809           R-squared     =  0.2527
-------------+------------------------------           Adj R-squared =  0.2518
       Total |   139.28615   757  .183997556           Root MSE      =  .37105

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .0966245   .0060425    15.99   0.000     .0847624    .1084866
       _cons |   4.391486   .0821136    53.48   0.000     4.230288    4.552684
------------------------------------------------------------------------------

. eststo basic_model, title("Model 1")

. 
. reg `y' `x' `controls'

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  9,   748) =   47.87
       Model |   50.902211     9  5.65580123           Prob > F      =  0.0000
    Residual |  88.3839388   748  .118160346           R-squared     =  0.3655
-------------+------------------------------           Adj R-squared =  0.3578
       Total |   139.28615   757  .183997556           Root MSE      =  .34374

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .0874834     .00709    12.34   0.000     .0735648    .1014021
         kww |    .003179    .001959     1.62   0.105    -.0006668    .0070247
          iq |   .0131465   .0066343     1.98   0.048     .0001224    .0261706
        expr |   .0389122   .0063629     6.12   0.000     .0264209    .0514035
      tenure |    .032076   .0078302     4.10   0.000     .0167042    .0474477
         rns |   -.072066   .0289568    -2.49   0.013    -.1289122   -.0152197
        smsa |   .1285249   .0281083     4.57   0.000     .0733444    .1837054
         med |   .0058976   .0049513     1.19   0.234    -.0038225    .0156177
       test3 |  -.0102099   .0064909    -1.57   0.116    -.0229524    .0025326
       _cons |    3.93268   .1269571    30.98   0.000     3.683445    4.181914
------------------------------------------------------------------------------

. eststo full_model, title("Model 2")

. 
. #delimit ;
delimiter now ;
. quietly esttab * using `y'_models.`filetype',          /* estout command: * indicates all estima
> tes in memory */
>                label                          /*Use labels for models and variables */
>                nodepvars                      /* Use my model titles */
>                b(2)                           /* b= coefficients , this gives two sig digits */
>                not                            /* I don't want t statistics */
>                se(2)                         /* I do want standard errors */
>                nostar                       /* No stars */
>                r2 (2)                      /* R squared */
>                ar2 (2)                     /* Adj R squared */
>                scalar(F  "df_m D.F. Model" "df_r D.F. Residual" N)   /* select stats from the er
> eturn (list) */
>                sfmt (2 0 0 0)               /* format for stats*/
>                replace                   /* replace existing file */
>                mtitles ("No Controls" "Student Controls" "Students and Finance" "Full Model")  /
> *  Model titles */
>                ;

. #delimit cr
delimiter now cr
. 
. /**************************************************/
. /*Collinearity*/
. /**************************************************/  
. estimates restore full_model
(results full_model are active now)

. 
. estat vif

    Variable |       VIF       1/VIF  
-------------+----------------------
          iq |     52.30    0.019121
       test3 |     51.76    0.019321
           s |      1.60    0.623393
         kww |      1.31    0.762775
         med |      1.18    0.847380
        expr |      1.15    0.869634
      tenure |      1.10    0.908892
         rns |      1.06    0.945149
        smsa |      1.06    0.947727
-------------+----------------------
    Mean VIF |     12.50

. 
. test test3 iq /* Combined these two need to be in the model */

 ( 1)  test3 = 0
 ( 2)  iq = 0

       F(  2,   748) =    4.60
            Prob > F =    0.0104

. 
. local controls kww iq expr tenure rns smsa med 

. 
. reg `y' `x' `controls'

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  8,   749) =   53.43
       Model |  50.6098566     8  6.32623207           Prob > F      =  0.0000
    Residual |  88.6762933   749  .118392915           R-squared     =  0.3634
-------------+------------------------------           Adj R-squared =  0.3566
       Total |   139.28615   757  .183997556           Root MSE      =  .34408

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .0878976   .0070921    12.39   0.000     .0739749    .1018203
         kww |   .0030669   .0019596     1.57   0.118    -.0007801    .0069139
          iq |   .0028559   .0011028     2.59   0.010      .000691    .0050208
        expr |   .0386396   .0063668     6.07   0.000     .0261407    .0511385
      tenure |   .0322462   .0078371     4.11   0.000     .0168608    .0476315
         rns |  -.0720075   .0289852    -2.48   0.013    -.1289095   -.0151055
        smsa |   .1302547   .0281144     4.63   0.000     .0750623    .1854471
         med |   .0055788    .004952     1.13   0.260    -.0041427    .0153004
       _cons |   3.840349   .1126832    34.08   0.000     3.619136    4.061561
------------------------------------------------------------------------------

. 
. eststo full_model_a, title("Model 2:No Test 3")

. 
. estat vif

    Variable |       VIF       1/VIF  
-------------+----------------------
           s |      1.60    0.624254
          iq |      1.44    0.693400
         kww |      1.31    0.763785
         med |      1.18    0.848802
        expr |      1.15    0.870279
      tenure |      1.10    0.909065
         rns |      1.06    0.945150
        smsa |      1.05    0.949180
-------------+----------------------
    Mean VIF |      1.24

. 
. 
. 
. /**************************************************/
. /*Heteroskedasticity*/
. /**************************************************/
.   
. 
. reg lw_het  `x' `controls'

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  8,   749) =    1.78
       Model |  246.321772     8  30.7902214           Prob > F      =  0.0767
    Residual |  12920.0966   749  17.2497953           R-squared     =  0.0187
-------------+------------------------------           Adj R-squared =  0.0082
       Total |  13166.4184   757  17.3928909           Root MSE      =  4.1533

------------------------------------------------------------------------------
      lw_het |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .1101308   .0856057     1.29   0.199    -.0579249    .2781864
         kww |   .0301567   .0236539     1.27   0.203     -.016279    .0765924
          iq |  -.0074044   .0133112    -0.56   0.578    -.0335361    .0187273
        expr |  -.0617517   .0768512    -0.80   0.422    -.2126211    .0891177
      tenure |   -.063156   .0945991    -0.67   0.505     -.248867    .1225549
         rns |  -.4993664   .3498695    -1.43   0.154    -1.186208    .1874751
        smsa |  -.6310567   .3393576    -1.86   0.063    -1.297262    .0351486
         med |   .0667451   .0597741     1.12   0.265    -.0505996    .1840897
       _cons |   3.961471   1.360155     2.91   0.004     1.291301     6.63164
------------------------------------------------------------------------------

. 
. estimates store het_model

. 
. predict e, resid

. 
. graph twoway scatter e s, yline(0) name(residplot1)

. 
. graph export het_results.`gtype', replace
(file /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/het_results.pdf written
>  in PDF format)

. 
. /*Breusch-Pagen Test */
. est restore het_model
(results het_model are active now)

. 
. //No options, yhat is used as the covariate
. 
. estat hettest , iid 

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: fitted values of lw_het

         chi2(1)      =     7.08
         Prob > chi2  =   0.0078

. 
. //BP with subsets of covariates
. 
. estat hettest `controls', iid

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: kww iq expr tenure rns smsa med

         chi2(7)      =     6.36
         Prob > chi2  =   0.4985

. 
. estat hettest s expr

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: s expr

         chi2(2)      =    20.53
         Prob > chi2  =   0.0000

. 
. /*White Test */
.   
. estat imtest, white

White's test for Ho: homoskedasticity
         against Ha: unrestricted heteroskedasticity

         chi2(42)     =     71.18
         Prob > chi2  =    0.0033

Cameron & Trivedi's decomposition of IM-test

---------------------------------------------------
              Source |       chi2     df      p
---------------------+-----------------------------
  Heteroskedasticity |      71.18     42    0.0033
            Skewness |       6.15      8    0.6305
            Kurtosis |      14.35      1    0.0002
---------------------+-----------------------------
               Total |      91.68     51    0.0004
---------------------------------------------------

. 
. /*Robust s.e.'s*/
. reg lw_het `x' `controls', robust

Linear regression                                      Number of obs =     758
                                                       F(  8,   749) =    2.08
                                                       Prob > F      =  0.0354
                                                       R-squared     =  0.0187
                                                       Root MSE      =  4.1533

------------------------------------------------------------------------------
             |               Robust
      lw_het |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .1101308   .0841732     1.31   0.191    -.0551126    .2753742
         kww |   .0301567   .0253353     1.19   0.234    -.0195799    .0798933
          iq |  -.0074044   .0120285    -0.62   0.538    -.0310181    .0162093
        expr |  -.0617517   .0766726    -0.81   0.421    -.2122704    .0887671
      tenure |   -.063156   .1075666    -0.59   0.557    -.2743239    .1480118
         rns |  -.4993664   .3218263    -1.55   0.121    -1.131155    .1324224
        smsa |  -.6310567   .3423779    -1.84   0.066    -1.303191    .0410778
         med |   .0667451   .0559967     1.19   0.234    -.0431841    .1766743
       _cons |   3.961471   1.168143     3.39   0.001     1.668247    6.254694
------------------------------------------------------------------------------

. eststo full_model_robust, title("Model 2: Robust SE")

. 
. 
. /*Clustered se.'s*/
. reg `y' `x' `controls', cluster(med)

Linear regression                                      Number of obs =     758
                                                       F(  8,    18) =  126.22
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.3634
                                                       Root MSE      =  .34408

                                   (Std. Err. adjusted for 19 clusters in med)
------------------------------------------------------------------------------
             |               Robust
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .0878976   .0090694     9.69   0.000     .0688436    .1069516
         kww |   .0030669   .0017164     1.79   0.091    -.0005391    .0066729
          iq |   .0028559   .0008181     3.49   0.003      .001137    .0045747
        expr |   .0386396   .0068981     5.60   0.000     .0241472     .053132
      tenure |   .0322462   .0049196     6.55   0.000     .0219105    .0425818
         rns |  -.0720075   .0236252    -3.05   0.007    -.1216422   -.0223729
        smsa |   .1302547    .014499     8.98   0.000     .0997935    .1607159
         med |   .0055788    .003547     1.57   0.133    -.0018732    .0130309
       _cons |   3.840349   .1197726    32.06   0.000     3.588716    4.091982
------------------------------------------------------------------------------

. eststo full_model_cluster, title("Model 2: Cluster SE")

. 
.   
. /*Data Scaling*/
. 
. reg `y' `x' `controls'

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  8,   749) =   53.43
       Model |  50.6098566     8  6.32623207           Prob > F      =  0.0000
    Residual |  88.6762933   749  .118392915           R-squared     =  0.3634
-------------+------------------------------           Adj R-squared =  0.3566
       Total |   139.28615   757  .183997556           Root MSE      =  .34408

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .0878976   .0070921    12.39   0.000     .0739749    .1018203
         kww |   .0030669   .0019596     1.57   0.118    -.0007801    .0069139
          iq |   .0028559   .0011028     2.59   0.010      .000691    .0050208
        expr |   .0386396   .0063668     6.07   0.000     .0261407    .0511385
      tenure |   .0322462   .0078371     4.11   0.000     .0168608    .0476315
         rns |  -.0720075   .0289852    -2.48   0.013    -.1289095   -.0151055
        smsa |   .1302547   .0281144     4.63   0.000     .0750623    .1854471
         med |   .0055788    .004952     1.13   0.260    -.0041427    .0153004
       _cons |   3.840349   .1126832    34.08   0.000     3.619136    4.061561
------------------------------------------------------------------------------

.   
. reg `y' `x' `controls', beta

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  8,   749) =   53.43
       Model |  50.6098566     8  6.32623207           Prob > F      =  0.0000
    Residual |  88.6762933   749  .118392915           R-squared     =  0.3634
-------------+------------------------------           Adj R-squared =  0.3566
       Total |   139.28615   757  .183997556           Root MSE      =  .34408

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|                     Beta
-------------+----------------------------------------------------------------
           s |   .0878976   .0070921    12.39   0.000                 .4573323
         kww |   .0030669   .0019596     1.57   0.118                 .0522099
          iq |   .0028559   .0011028     2.59   0.010                 .0906704
        expr |   .0386396   .0063668     6.07   0.000                 .1896665
      tenure |   .0322462   .0078371     4.11   0.000                 .1258147
         rns |  -.0720075   .0289852    -2.48   0.013                -.0745005
        smsa |   .1302547   .0281144     4.63   0.000                 .1386435
         med |   .0055788    .004952     1.13   0.260                 .0356506
       _cons |   3.840349   .1126832    34.08   0.000                        .
------------------------------------------------------------------------------

. 
. eststo full_model_beta, title("Model 2: Standardized Coefficients")

. 
. gen expr_new=1+2*s

. 
. local x expr_new

. 
. reg `y' `x' `controls', beta

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  8,   749) =   53.43
       Model |  50.6098566     8  6.32623207           Prob > F      =  0.0000
    Residual |  88.6762933   749  .118392915           R-squared     =  0.3634
-------------+------------------------------           Adj R-squared =  0.3566
       Total |   139.28615   757  .183997556           Root MSE      =  .34408

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|                     Beta
-------------+----------------------------------------------------------------
    expr_new |   .0439488    .003546    12.39   0.000                 .4573323
         kww |   .0030669   .0019596     1.57   0.118                 .0522099
          iq |   .0028559   .0011028     2.59   0.010                 .0906704
        expr |   .0386396   .0063668     6.07   0.000                 .1896665
      tenure |   .0322462   .0078371     4.11   0.000                 .1258147
         rns |  -.0720075   .0289852    -2.48   0.013                -.0745005
        smsa |   .1302547   .0281144     4.63   0.000                 .1386435
         med |   .0055788    .004952     1.13   0.260                 .0356506
       _cons |     3.7964   .1134835    33.45   0.000                        .
------------------------------------------------------------------------------

. 
. local x s

. 
. /**************************************************/
. /*Functional Form */
. /**************************************************/
. 
. graph twoway scatter w s, msize(tiny)||lowess w s ,name(lowess_plot)

. 
. graph export lowess1.`gtype', replace
(file /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/lowess1.pdf written in 
> PDF format)

. 
. graph twoway scatter w s, msize(tiny)||lowess w s ||lfit w s ,name(lfit_plot)

. 
. graph export lfit1.`gtype', replace
(file /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/lfit1.pdf written in PD
> F format)

. 
. /* Basic scatterplot */
. graph twoway scatter lw expr, msize(tiny)

. 
. graph save basic_scatter, replace
(file basic_scatter.gph saved)

. 
. /* Add lowess */
. graph twoway scatter lw expr, msize(tiny)  ///
>   ||lowess lw expr ||, legend (order(2 "Lowess"))

. graph save lowess_add, replace
(file lowess_add.gph saved)

. 
. /* Add linear fit */
. graph twoway scatter lw expr, msize(tiny) ///
>   ||lowess lw expr ///
>   || lfit lw expr, ///
>   legend(order(2 "Lowess" 3 "Linear Fit"))

.    
. graph save lfit_add, replace
(file lfit_add.gph saved)

. 
. /* Add quadratic fit */
. graph twoway scatter lw expr, msize(tiny) ///
>   ||lowess lw expr ///
>   || lfit lw expr ///
>   || qfit lw expr, ///
>   legend(order(2 "Lowess" 3 "Linear Fit" 4 "Quadratic Fit"))

. 
. graph save qfit_add, replace 
(file qfit_add.gph saved)

. 
. graph combine basic_scatter.gph lowess_add.gph lfit_add.gph qfit_add.gph, rows(2)

. 
. graph export logfit.`gtype', replace
(file /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/logfit.pdf written in P
> DF format)

. 
. reg lw s expr expr2

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  3,   754) =  108.26
       Model |   41.934855     3   13.978285           Prob > F      =  0.0000
    Residual |  97.3512949   754  .129113123           R-squared     =  0.3011
-------------+------------------------------           Adj R-squared =  0.2983
       Total |   139.28615   757  .183997556           Root MSE      =  .35932

------------------------------------------------------------------------------
          lw |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   .1071039   .0060328    17.75   0.000     .0952609    .1189469
        expr |    .017041   .0161983     1.05   0.293    -.0147582    .0488401
       expr2 |   .0039664   .0021414     1.85   0.064    -.0002375    .0081703
       _cons |    4.19193   .0855647    48.99   0.000     4.023956    4.359903
------------------------------------------------------------------------------

. 
. test expr expr2

 ( 1)  expr = 0
 ( 2)  expr2 = 0

       F(  2,   754) =   26.07
            Prob > F =    0.0000

. 
. 
. /**************************************************/
. /* Influential Observiations*/
. /**************************************************/  
. 
. reg  w_influence s expr expr2

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  3,   754) =   85.42
       Model |  6746651.02     3  2248883.67           Prob > F      =  0.0000
    Residual |  19851657.7   754  26328.4585           R-squared     =  0.2536
-------------+------------------------------           Adj R-squared =  0.2507
       Total |  26598308.8   757  35136.4713           Root MSE      =  162.26

------------------------------------------------------------------------------
 w_influence |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   43.08757   2.724237    15.82   0.000     37.73958    48.43557
        expr |   14.87053   7.314709     2.03   0.042      .510917    29.23015
       expr2 |    .442536   .9670089     0.46   0.647    -1.455814    2.340886
       _cons |  -276.8727   38.63867    -7.17   0.000    -352.7249   -201.0206
------------------------------------------------------------------------------

. 
. scalar reg_n=e(N)

. 
. /* leverage plot */
. 
. lvr2plot, msize(tiny) name(leverage_plot)

. 
. graph export levplot.`gtype', replace
(file /Users/doylewr/practicum/lpo_prac_2016-2017/central/lessons/diagnose/levplot.pdf written in 
> PDF format)

. 
. /* Leverage and outliers  */
.   
. predict lev if e(sample), leverage

. 
. predict resid if e(sample), resid

. 
. gen  resid2=resid^2

. 
. gsort -lev

. 
. list w_influence s lev resid2 in 1/10

     +-------------------------------------+
     | w_infl~e    s        lev     resid2 |
     |-------------------------------------|
  1. | 555.0176   11   .1402453   16845.92 |
  2. | 401.0154   12   .1191845   3480.702 |
  3. | 430.0924    9   .0920351   12456.28 |
  4. | 454.8647   12   .0682902    395.947 |
  5. | 204.9979   10   .0488069   16943.56 |
     |-------------------------------------|
  6. | 288.0114   12    .045244   17041.28 |
  7. | 367.9695   12    .037804   1923.356 |
  8. | 375.0278    9   .0375033   8861.435 |
  9. | 600.0421   12   .0371506   35667.26 |
 10. | 332.9526   11   .0312744   839.5032 |
     +-------------------------------------+

. 
. exit 

end of do-file


. sum w_influence

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
 w_influence |       758    329.8156    187.4472   99.98299       2000

. 
. list w_influence s lev resid2 in 1/20

     +-------------------------------------+
     | w_infl~e    s        lev     resid2 |
     |-------------------------------------|
  1. | 555.0176   11   .1402453   16845.92 |
  2. | 401.0154   12   .1191845   3480.702 |
  3. | 430.0924    9   .0920351   12456.28 |
  4. | 454.8647   12   .0682902    395.947 |
  5. | 204.9979   10   .0488069   16943.56 |
     |-------------------------------------|
  6. | 288.0114   12    .045244   17041.28 |
  7. | 367.9695   12    .037804   1923.356 |
  8. | 375.0278    9   .0375033   8861.435 |
  9. | 600.0421   12   .0371506   35667.26 |
 10. | 332.9526   11   .0312744   839.5032 |
     |-------------------------------------|
 11. | 961.9861   16   .0290767   155736.2 |
 12. | 244.9367   12   .0251759   23214.04 |
 13. | 254.9328    9   .0219757   27.08536 |
 14. | 300.0653   12   .0202071   8031.927 |
 15. | 462.2011   14   .0196361   99.83777 |
     |-------------------------------------|
 16. | 362.8538   12   .0192746   635.2373 |
 17. | 433.1136   12   .0188376   2101.894 |
 18. | 244.9367   12   .0165479   19002.82 |
 19. | 199.9365   10   .0151909   8364.369 |
 20. |     2000   18   .0135664    2006301 |
     +-------------------------------------+

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04386.000000"

. 
. predict  dfits if e(sample), dfits

. 
. gsort -dfits

. 
. generate cutoff =abs(dfits)> 2*sqrt((e(df_m)+1)/e(N)) & e(sample)

. 
. list w_influence s dfits if cutoff

     +---------------------------+
     | w_infl~e    s       dfits |
     |---------------------------|
  1. |     2000   18    1.087261 |
  2. |     2000   18    .9948739 |
  3. |     2000   18    .9187664 |
  4. |     2000   18    .8395817 |
  5. | 961.9861   16    .4285912 |
     |---------------------------|
  6. | 555.0176   11    .3483618 |
  7. | 600.0421   12    .2330579 |
  8. | 430.0924    9    .2297477 |
  9. | 938.2344   14    .2089124 |
 10. | 625.1553   11    .2080431 |
     |---------------------------|
 11. |  749.945   12    .1982541 |
 12. |  749.945   12    .1964909 |
 13. | 837.9848   13    .1944492 |
 14. |  865.234   17    .1892176 |
 15. | 724.8755   12     .188384 |
     |---------------------------|
 16. | 470.1256   10    .1652541 |
 17. | 665.1417   12    .1649384 |
 18. | 885.3648   16    .1599936 |
 19. | 817.2948   17    .1490838 |
750. | 244.9367   12   -.1528273 |
     |---------------------------|
751. | 224.0793   18   -.1536943 |
752. | 209.9774   17   -.1620944 |
753. | 288.0114   12   -.1791981 |
754. | 204.9979   10    -.186281 |
755. | 150.0547   18   -.1867089 |
     |---------------------------|
756. | 244.9367   16   -.1897722 |
757. | 199.9365   16   -.2014552 |
758. | 132.9536   18   -.2031146 |
     +---------------------------+

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04386.000000"

. 
. predict cooksd1 if e(sample), cooksd

. 
. generate cutoff2=4/reg_n

. 
. gsort -cooksd1

. 
. li w_influence resid2 lev cooksd if cooksd1>cutoff2

     +-------------------------------------------+
     | w_infl~e     resid2        lev    cooksd1 |
     |-------------------------------------------|
  1. |     2000    2006301   .0135664   .2656075 |
  2. |     2000    2093949   .0108914   .2213494 |
  3. |     2000    2140688   .0090967   .1883172 |
  4. |     2000    2186048   .0074457   .1568812 |
  5. | 961.9861   155736.2   .0290767    .045612 |
     |-------------------------------------------|
  6. | 555.0176   16845.92   .1402453   .0303493 |
  7. | 600.0421   35667.26   .0371506   .0135717 |
  8. | 430.0924   12456.28   .0920351   .0132044 |
  9. | 625.1553   87345.66   .0126778   .0107866 |
 10. | 938.2344   374398.6   .0029971   .0107189 |
     |-------------------------------------------|
 11. | 132.9536   133773.1   .0079474   .0102574 |
 12. | 199.9365   100093.9   .0104145   .0101078 |
 13. |  749.945   259862.2   .0039044   .0097099 |
 14. |  749.945   181743.9   .0054882    .009576 |
 15. | 837.9848   307713.2   .0031689    .009318 |
     |-------------------------------------------|
 16. | 244.9367   78472.94   .0117686   .0089793 |
 17. |  865.234   138200.6   .0066916   .0088999 |
 18. | 724.8755   234931.6   .0039044   .0087784 |
 19. | 204.9979   16943.56   .0488069   .0086789 |
 20. | 150.0547     125552   .0071694    .008671 |
     |-------------------------------------------|
 21. | 288.0114   17041.28    .045244   .0080314 |
 22. | 470.1256   99933.49   .0070669   .0068016 |
 23. | 665.1417     180594   .0039044    .006748 |
 24. | 209.9774   86583.37   .0078407   .0065485 |
 25. | 885.3648   211486.6   .0031371   .0063395 |
     |-------------------------------------------|
 26. | 224.0793   85808.53   .0071233   .0058876 |
 27. | 244.9367   23214.04   .0251759   .0058398 |
 28. | 817.2948   118385.4   .0048721   .0055305 |
     +-------------------------------------------+

. 
end of do-file

. do "/var/folders/h_/wc0n_t2j437g61hxg5t3sbdw1bjh2n/T//SD04386.000000"

.   
. /*DfBeta*/
. dfbeta
                       _dfbeta_1: dfbeta(s)
                       _dfbeta_2: dfbeta(expr)
                       _dfbeta_3: dfbeta(expr2)

. 
. scalar dfbeta_cutoff=2/sqrt(reg_n)

. 
. li _dfbeta_1 if _dfbeta_1>dfbeta_cutoff

     +----------+
     | _dfbet~1 |
     |----------|
  1. | .8421012 |
  2. | .7888865 |
  3. | .7607225 |
  4. |  .734001 |
  5. | .1875062 |
     |----------|
 17. | .1436582 |
 25. | .1133176 |
 28. | .1227915 |
 33. | .1167485 |
 35. | .0952898 |
     |----------|
 38. |  .084236 |
 42. | .0972999 |
 46. | .1012995 |
 48. | .0810492 |
 64. |  .076148 |
     |----------|
 70. | .0743705 |
 73. | .0751916 |
     +----------+

. 
end of do-file

. reg  w_influence s expr expr2

      Source |       SS       df       MS              Number of obs =     758
-------------+------------------------------           F(  3,   754) =   85.42
       Model |  6746651.02     3  2248883.67           Prob > F      =  0.0000
    Residual |  19851657.7   754  26328.4585           R-squared     =  0.2536
-------------+------------------------------           Adj R-squared =  0.2507
       Total |  26598308.8   757  35136.4713           Root MSE      =  162.26

------------------------------------------------------------------------------
 w_influence |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           s |   43.08757   2.724237    15.82   0.000     37.73958    48.43557
        expr |   14.87053   7.314709     2.03   0.042      .510917    29.23015
       expr2 |    .442536   .9670089     0.46   0.647    -1.455814    2.340886
       _cons |  -276.8727   38.63867    -7.17   0.000    -352.7249   -201.0206
------------------------------------------------------------------------------

. 
. exit, clear
