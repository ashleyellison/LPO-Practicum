------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/doylewr/practicum_2017/central/lessons/s1-07-cleaning/cleaning.log
  log type:  text
 opened on:  24 Oct 2017, 11:46:02

. 
. // NAME: Data cleaning
. // FILE: lecture9_cleaning.do
. // AUTH: Will Doyle
. // REVS: Benjamin Skinner
. // INIT: 15 October 2014
. // LAST: 24 Ocotber 2017
.   
. clear all                               // clear memory

. set more off                            // turn off annoying "__more__" feature

. 
. // load CA school data with problems
. use caschool_problem, replace

. 
. 
. // label data
. 
. la data "California school district-level data from 1998" 

. 
. 
. // replacing problematic variable labels 
. describe

Contains data from caschool_problem.dta
  obs:           420                          California school district-level data from
                                                1998
 vars:            19                          19 Oct 2010 10:56
 size:        60,060                          
------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------------
observation_n~r float   %9.0g                 Observation
dist_cod        float   %9.0g                 District Code
county          str18   %18s                  County
district        str53   %53s                  District
gr_span         str8    %8s                   gr
enrl_tot        float   %9.0g                 Enrollment as of census
teachers        float   %9.0g                 teachers
calw_pct        float   %9.0g                 
meal_pct        float   %9.0g                 Meals
computer        float   %9.0g                 computer
testscr         float   %9.0g                 API INDEX
comp_stu        float   %9.0g                 comp_stu
expn_stu        float   %9.0g                 Expenditures per student
str             float   %9.0g                 ratio
avginc          float   %9.0g                 avginc
el_pct          float   %9.0g                 ELL
read_scr        float   %9.0g                 
math_scr        float   %9.0g                 
foo             float   %9.0g                 
------------------------------------------------------------------------------------------
Sorted by:  

. label variable observation_number "Unit ID"

. label variable gr_span "Grade Span"

. 
. // I AM MAKING AN ASSUMPTION ABOUT THIS VARIABLE//
. // WE REALLY REALLY NEED TO CHECK THIS *****  //
. 
. la var teachers "Full time equivalent teachers" 

. 
. la var calw "Percent of students whose parents are enrolled in CalWorks"

. 
. la var meal_pct "Percent of students eligible for free/reduced price meals" 

. 
. la var computer "Number of computers in the district" 

. 
. la var testscr "Academic Performance Index score" 

. 
. la var comp_stu "Number of computers per student" 

. 
. la var str "Student/Teacher Ratio"

. 
. // I AM MAKING AN ASSUMPTION ABOUT THIS VARIABLE//
. // WE REALLY REALLY NEED TO CHECK THIS *****  //
. 
. la var avginc "Average income (maybe)" 

. 
. la var el_pct "English language learners percent" 

. 
. 
. //Flag this for missing ***** //
. la var read_scr "Average reading score"

. 
. //Flag this for missing ***** //
. la var math_scr "Average math score"  

. 
. la var foo "Unknown variable" 

. 
. 
. // LOOKING FOR OUTLIERS WITH VARIOUS PLOTS
. 
. // box plot str
. graph box str, name(box_str)

. graph export  box_str.eps, name(box_str) replace
(file box_str.eps written in EPS format)

. 
. // histogram str
. histogram str, name(hist_str)
(bin=20, start=14, width=1.6700001)

. graph export  hist_str.eps, name(hist_str) replace
(file hist_str.eps written in EPS format)

. 
. // NOTE: student teacher ratio for observation #121 coded incorrectly (was 47.4, ratio i
> s about 18
. // Code below replaces for this district 
. replace str =enrl_tot/teachers if observation_number==121
(1 real change made)

. 
. // NOTE: student teacher ratio for observation #301 coded incorrectly (was 34, ratio is 
> about 18
. // Code below replaces for this district 
. replace str =enrl_tot/teachers if observation_number==301
(1 real change made)

. 
. // IMPOSSIBLE VALUES 
. 
. // summarize calw percent
. sum calw_pct

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
    calw_pct |       420    13.46038    12.25822          0      102.7

. 
. // Remove impossible values for calworks because some schools recorded more than 100
. replace calw_pct =. if calw_pct>100
(1 real change made, 1 to missing)

. 
. // LOOKING FOR IMPLAUSIBLE VALUES WITH VARIOUS PLOTS
. 
. // twoway scatter of avginc and meal_pct
. graph twoway scatter avginc meal_pct, name(sc_inc_meal)

. graph export  sc_inc_meal.eps, name(sc_inc_meal) replace
(file sc_inc_meal.eps written in EPS format)

. 
. 
. // Observation for raisin city income is problematic (far too high given other indicator
> s)
. 
. replace avginc=. if observation_number==38
(1 real change made, 1 to missing)

. 
. 
. // 
. 
. graph twoway scatter str expn_stu

. 
. // CHECKING CALCUATIONS
. 
. // create new student teacher ratio variable
. gen str_two = enrl_tot / teachers

. 
. // twoway scatter of both student teacher ratio variables
. graph twoway scatter str_two str, name(sc_str_str_two)

. graph export  sc_str_str_two.eps, name(sc_str_str_two) replace
(file sc_str_str_two.eps written in EPS format)

. 
. 
. // assume negative means missing and drop
. replace teachers = . if teachers == -4
(67 real changes made, 67 to missing)

. 
. // create another new student teacher ratio variable
. gen str_three = enrl_tot / teachers
(67 missing values generated)

. 
. // twoway scatter of new new and old student teacher ratio variables
. graph twoway scatter str_three str, name(sc_str_str_three)

. graph export  sc_str_str_three.eps, name(sc_str_str_three) replace
(file sc_str_str_three.eps written in EPS format)

. 
. // Replacing two school districts because # of teachers was problematic
. replace str_three=. if str_three>75 
(2 real changes made, 2 to missing)

. 
. // twoway scatter of new new and old student teacher ratio variables
. graph twoway scatter str_three str, name(sc_str_str_three_b)

. graph export  sc_str_str_three.eps, name(sc_str_str_three_b) replace
(file sc_str_str_three.eps written in EPS format)

. 
. 
. // Other calculation problems
. 
. gen comp_stu_two=computer/enrl_tot

. 
. graph twoway scatter comp_stu_two comp_stu

. 
. //Replacing computers per student for two school districts because of implausibly low 
. // numbers of computers relative to enrollment. 
. replace comp_stu_two=. if comp_stu_two<.1 & comp_stu>.1
(2 real changes made, 2 to missing)

. 
. // LOOKING FOR DUPLICATES 
. 
. // check for duplicate observations
. duplicates report observation_number

Duplicates in terms of observation_number

--------------------------------------
   copies | observations       surplus
----------+---------------------------
        1 |          420             0
--------------------------------------

. 
. // check for duplicate district cod
. duplicates report dist_cod

Duplicates in terms of dist_cod

--------------------------------------
   copies | observations       surplus
----------+---------------------------
        1 |          418             0
        2 |            2             1
--------------------------------------

. 
. replace dist_cod=. if dist_cod==75051
(2 real changes made, 2 to missing)

. 
. // CHECK FOR NEGATIVE VALUES, MISSING DATA
. 
. // inspect test scores
. inspect testscr

testscr:  Academic Performance Index score      Number of Observations
------------------------------------------  ------------------------------
                                            Total   Integers   Nonintegers
|          #                 Negative           -         -          -
|          #                 Zero               -         -          -
|      #   #                 Positive         420        17        403
|      #   #   #                            -----     -----      -----
|      #   #   #             Total            420        17        403
|  #   #   #   #   .         Missing            -
+----------------------                     -----
605.55           706.75                       420
(More than 99 unique values)

. 
. // inspect reading scores
. inspect read_scr

read_scr:  Average reading score                Number of Observations
--------------------------------            ------------------------------
                                            Total   Integers   Nonintegers
|                  #         Negative          77        77          -
|                  #         Zero              15        15          -
|                  #         Positive         328        33        295
|                  #                        -----     -----      -----
|                  #         Total            420       125        295
|  #   .   .   .   #         Missing            -
+----------------------                     -----
-1                  704                       420
(More than 99 unique values)

. 
. replace read_scr=. if read_scr<=0
(92 real changes made, 92 to missing)

. 
. // plot reading scores for further investigation
. histogram read_scr, name(hist_read_scr)
(bin=18, start=604.5, width=5.5277778)

. graph export hist_read_scr.eps, name(hist_read_scr) replace                             
>                  
(file hist_read_scr.eps written in EPS format)

. 
. inspect math_scr

math_scr:  Average math score                   Number of Observations
-----------------------------               ------------------------------
                                            Total   Integers   Nonintegers
|                  #         Negative          36        36          -
|                  #         Zero               8         8          -
|                  #         Positive         376        30        346
|                  #                        -----     -----      -----
|                  #         Total            420        74        346
|  .   .   .   .   #         Missing            -
+----------------------                     -----
-4                709.5                       420
(More than 99 unique values)

. 
. histogram math_scr
(bin=20, start=-4, width=35.675)

. 
. replace math_scr= . if math_scr<=0
(44 real changes made, 44 to missing)

. 
. histogram math_scr
(bin=19, start=605.40002, width=5.4789461)

. 
. mvpatterns math_scr read_scr
Variable     | type     obs   mv   variable label
-------------+------------------------------------------
math_scr     | float    376   44   Average math score
read_scr     | float    328   92   Average reading score
--------------------------------------------------------

Patterns of missing values

  +------------------------+
  | _pattern   _mv   _freq |
  |------------------------|
  |       ++     0     296 |
  |       +.     1      80 |
  |       .+     1      32 |
  |       ..     2      12 |
  +------------------------+

. 
. // end file     
. log close
      name:  <unnamed>
       log:  /Users/doylewr/practicum_2017/central/lessons/s1-07-cleaning/cleaning.log
  log type:  text
 closed on:  24 Oct 2017, 11:46:17
------------------------------------------------------------------------------------------
